<html>
<header>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../static/js/jquery-1.11.0.min.js"></script>
<style type="text/css">
#grey{
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: Grey;
	opacity: 0.5;
	display: none;
}
#bg{
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: #00FF00;
	z-index: 1;
}
#navi{
	position: fixed;
	top: 0px;
	width: 1000px;
	height: 30px;
	background-color: #0000FF;
	text-align: right;
	z-index: 10;
}
#create{
	position: fixed;
	top: 30px;
	width: 1000px;
	height: 300px;
	background-color: #FFFFFF;
	display: none;
}
#profile{
	position: fixed;
	top: 30px;
	width: 200px;
	height: 350px;
	background-color: #00FFFF;
	z-index: 2;
}
#rolelist{
	position: fixed;
	top: 380px;
	width: 200px;
	height: 50px;
	background-color: #007777;
	z-index: 2;
}
#main{
	position: absolute;
	top: 30px;
	width: 600px;
	height: 100%;
	z-index: 2;
}
#right{
	position: fixed;
	top: 30px;
	width: 200px;
	background-color: #FFFF00;
	z-index: 2;
}
div.role{
	width: 200px;
	height: 30px;
	background-color: #007700;
}
div.post{
	position: relative;
	width: 500px;
	background-color: rgba(255,255,255,100);
	margin : 5px;
}
</style>
<script type="text/javascript">
var w_width, w_height, c_left, c_height;

function setFrame () {
	w_width = window.innerWidth ? window.innerWidth : $(window).width();
	c_left = 0;
	if (w_width > 1000) {
		c_left = (w_width - 1000)/2;
	}

	w_height = window.innerHeight ? window.innerHeight : $(window).height();
	if (w_height < 500) {
		c_height = 500;
	}
	c_height = w_height - 30;

	$("#bg").css("height", c_height+30);
	$("#navi").css("left", c_left);
	$("#create").css("left", c_left);
	$("#profile").css("left", c_left);
	$("#rolelist").css("left", c_left);
//	$("#rolelist").css("height", role_height);
	$("#main").css("left", c_left+200);
//	$("#main").css("height", c_height);
	$("#right").css("left", c_left+800);
	$("#right").css("height", c_height);
}

function clickRole (role) {
	var rolelist = {{ session['role_list']|safe }};
	var hit;

/*
	for (var i=0; i < role_list.length; i++) {
		if (role.id == role_list[i]) {
			if (i != 0) {
				hit = role_list[i];
				role_list[i] = role_list[0];
				role_list[0] = hit;
			}
			break;
		}
	}

	setRole();
*/
}

function setRole () {
	var role_top = 430;
	var role_cnt = role_list.length;
	var role_height = role_cnt > 3 ? 90 : role_cnt * 30;
	$("#rolelist").html("");
	for (var i = 0; i < role_cnt; i++) {
		$("#rolelist").append("<div id='"+role_list[i]+"' class='role' style='left:"+c_left+";top:"+role_top+"' onclick='clickRole(this)'>"+role_list[i]+"</div>");
		role_top += 30;
	}
}

function setRoleList () {
	var role_list = {{ session['role_list']|safe }};
	var role_cnt = role_list.length;
	var role_height = role_cnt > 3 ? 150 : role_cnt < 1 ? 50 : role_cnt * 50;
	var role_top = 380;

	$("#rolelist").css("height", role_height);

	if (role_list[0] != null && role_list[0]["whole_id"] != null) {
		$("#rolelist").html("");
		for (var i = 0; i < role_cnt; i++) {
			var r = role_list[i];
			$("#rolelist").append("<div id='"+r["whole_id"]+"' class='role' style='left:"+c_left+";top:"+role_top+"' onclick='clickRole(this)'>"+r["whole_name"]+"</div>");
			role_top += 50;
		}
	} else {
		$("#rolelist").html("not login");
	}
}

/*
function setLeft () {
	$("#left").append("<div id='profile' class='profile' style='left:"+c_left+"'>profile</div>");

	$("#left").append("<div id='rolelist' class='rolelist' style='left:"+c_left+"'>profile</div>");

	setRole();
}
*/

function setProfile () {
/*
	var role_list = $.parseJSON("{{ session['role_list']|safe }}");
*/
	var rolelist = {{ session['role_list']|safe }};
	var role = rolelist[0];
	var roleinfo ="";

	if (role) {
		var key = "";
		for (key in role) {
			roleinfo += key + ": " + role[key] + "<br>";
		}
	} else {
		roleinfo = "roleinfo is null";
	}
	$("#profile").html(roleinfo);
}

function setPost () {
	$("#main").append("<div id='post01' class='post'>post01</div>");
	$("#main").append("<div id='post02' class='post'>post02 post02 post02 post02 post02 post02 post02 post02 post02 post02 post02 post02 post02 post02</div>");
	$("#main").append("<div id='post03' class='post'>理由は半角英数の連なりは1単語として判断されるから。理由は半角英数の連なりは1単語として判断されるから。</div>");
/*
	$("#main").append("<div id='post04' class='post'>role_info={{ session['role_list']|safe }}</div>");

	$("#profile").text("role_list={{ session['role_list']|safe }}");
*/
}

function setHidden (id, value, form_name) {
	var h = document.getElementById(id);
	if (h) {
		h.value = value;
	} else {
		h = document.createElement('input');
		h.type = 'hidden';
		h.id = id;
		h.name = id;
		h.value = value;
		document.forms[form_name].appendChild(h);
	}
}

function clickEnter () {
	var form_name = "frm_enter";
	var form = document.forms[form_name];
	var txt_rol = document.getElementById("txt_rol");
	var txt_act = document.getElementById("txt_act");
	var txt_pwd = document.getElementById("txt_pwd");

	if (txt_rol.value.length == 0 ) {
		alert("rol.length=" + txt_rol.value.length);
		return false;
	}
	if (txt_act.value.length == 0 ) {
		alert("act.length=" + txt_act.value.length);
		return false;
	}
	if (txt_pwd.value.length < 4 ) {
		alert("pwd.length=" + txt_pwd.value.length);
		return false;
	}

	setHidden("hdn_rol", txt_rol.value, form_name);
	setHidden("hdn_act", txt_act.value, form_name);
	setHidden("hdn_pwd", txt_pwd.value, form_name);

	form.method = "post";
	form.submit();
}

function clickExit () {
	var form_name = "frm_exit";
	var form = document.forms[form_name];
	var txt_rol = document.getElementById("txt_rol");
	var txt_act = document.getElementById("txt_act");

	if (txt_rol.value.length == 0 ) {
		alert("rol.length=" + txt_rol.value.length);
		return false;
	}
	if (txt_act.value.length == 0 ) {
		alert("act.length=" + txt_act.value.length);
		return false;
	}

	setHidden("hdn_rol", txt_rol.value, form_name);
	setHidden("hdn_act", txt_act.value, form_name);

	form.method = "post";
	form.submit();
}

function onKeyDown (e) {
	if((e.which && e.which == 13) ||
		(e.keyCode && e.keyCode ==13)) {
		clickEnter();
		return false;
	}
}

function clickAddNew () {
	document.getElementById("grey").style.display = "block";
	document.getElementById("create").style.display = "block";
}

function clickCreate () {
	document.getElementById("grey").style.display = "none";
	document.getElementById("create").style.display = "none";
}

function loadNavi () {
	document.getElementById("navi").innerHTML = "\
		<table>\
			<tr>\
				<td>HalfMore LOGO</td>\
				<td width='20px'></td>\
				<td><input type='button' value='Add New' onclick='clickAddNew()'></td>\
				<td width='20px'></td>\
				<td><input type='text' id='txt_rol' size='10' maxlength='20' onkeydown='onKeyDown(event)'></td>\
				<td>@</td>\
				<td><input type='text' id='txt_act' size='10' maxlength='20' onkeydown='onKeyDown(event)'></td>\
				<td width='10px'></td>\
				<td><input type='password' id='txt_pwd' size='10' maxlength='20' onkeydown='onKeyDown(event)'></td>\
				<td width='10px'></td>\
				<td><input type='button' value='Enter' onclick='clickEnter()'></td>\
				<td width='10px'></td>\
				<td><input type='button' value='Exit' onclick='clickExit()'></td>\
			</tr>\
		</table>\
	";
}

$(function(){
	setFrame();

	loadNavi();

	setProfile();

	setRoleList();

	setPost();
});

$(window).resize(function() {
	setFrame();
});


</script>
</header>
<body>
<form name="frm_enter" action="/login"></form>
<form name="frm_exit" action="/logout"></form>
<form name="frm_create" action=""></form>
<div id="bg">
  <div id="navi"></div>
  <div id="profile"></div>
  <div id="rolelist"></div>
  <div id="main"></div>
  <div id="right">right</div>
</div>
<div id="grey"></div>
<div id="create" onclick="clickCreate()"></div>
</body>
</html>